\chapter{Design}\label{ch:design}

This chapter outlines the architecture of the system design, detailing the different subsystems and components to meet the requirements detailed in \cref{ch:requirements}. The system designed is composed of two main components, a server, in charge of manageming the users, authenticating them, and relaying the information form the users, and the terminals, which are the brains of the system and hold the main control for each community. It is worth to note that while the terminal is deployed in every community, the server is only deployed once and can be used for every user in the system. The architecture of the system can be seen in \todo{add image with architecture}. Note that there are other complementary elementes that they will be later explained.

\todo{ add image of architecture and explain}

\section{Terminals}

The terminals are the core part of the deployment and is where all the processing is done to manage each community. In order to provide the necesary capabilities for the community such as opening the garage doors and detecting the cars the following components are needed.

\subsection{Cameras}

Two cameras per door to be able to detect the cars when they are close to the garage door. This cameras are the ones in charge of sending live video to be able to detect the cars and later identify the licence plates. The requirements for the cameras are that they are wether proof and can withstand heavy rain, can send live feed and be connected to a central computer, and have support for infrared detection for low light events such as inside garage parkings or night. Different models of cameras where studied but the final camera used for this project was the \todo{add camera} because of \todo{add reason}

\todo{add image of camera}

Moreover, even thought the camera has infrarred capabilities, the infrarred light of the camera is pretty weak. Therefore an anditional infrared led was used to increase the quality of the image at night. Also the good part of this camera is their relative low price point and that they can be powered with \gls{poe}, that is, they can be power and connected to the networking with just one cable.

\todo{add infrared image and description}

\subsection{Computer}

For the computer, the main requirements where that it would need to have the necessary computing power to run the detection algorithm to detect the different vehicles and licence plates for each camera and the price point is low enough as there will be one in every community. This restiction to be able to run the detection algorithm limits to have a on-board GPU to run the models. For this, the Raspberry Pi family \autocite{raspberrypi} was discarded due to the limitation of not having an onboard GPU. This leads to only be able to use a product of the NVIDIA Jetson family \autocite{nvidiaJetsonModules}, as this are on board computers designed to be used with \gls{ml} models.

For this project, the NVIDIA Jetson Nano of 4 GBs was used as it offered the best price performance ratio and was sufficient enough to perform the computing requirements.

\subsection{Internet Connectivity}

In order to provide conectivity from the on-board computer to the server, a networking connection is needed to be established. As this deployment must be self sufficient and not depend on the infrastructure of each community, a router with 4G connection is deployed. For this case, a conventional router is used, the \todo{add router}. Moreover, in order to provide the connectivity for the different cameras and the computer, a switch was used. The switch was the \todo{add switch}.

\todo{add photo of switch and router}

\subsection{Rele Extension board}

In order to trigger the mechanism to activate the opening of the garage door of each community, this is done by means of a rele connected in paralel to the door system. The opening doors function with a line where a pull-down signal is sent whenever the mechanism wants to be activated. In order to perform this operation, a Rele Extension board was used for the NVIDIA Jetson. The reason is that after trials, the on-board GPIO were not strong enought to send a constant signal for some specific communities and the mechanism malfunctioned.

The Rele Extension board used was the \todo{add extension} due to the low price-point and the easy access to buy.

\section{Server}

The server is the point of contact to connect the users and the different communities. It allows the users to authenticate and connect to the sepcific community. It is based on a scalable archtutecture deployed in \gls{aws} due to the fast time-to-market capabilities and the scalability of it. The architecture used for this implementation is based on an Autoscaling Group deployed in a private VPC. An autoscaling group is used mainly to adapt to the load of the incoming users dinamically and be able to recover from errors. In order to allow connections from the different users, an Application Load Balancer is used. This distributes the load into the different instances deployed.

Inside each instance, a web server is isntalled with the content of the website is shown to the users. The framweork used is the NextJS \todo{add ref} as it is a React framwork used to build full-stack web applications. This allows to embed the website in mobile applications for iOS and Android in an easy and low mantainance manner. Check the \todo{add ref for the implementation} to see more information.

\section{Networking}

In order to connect the terminals with the server, a ZeroTier \todo{add ref} is used. This enableds to connect all the different terminals and server in a straighforwards and easy way on a single network. Moreover, it allows to connect remotely to the terminals to do mainenance or updates in the system.

\section{Monitoring}

In order to montior the different terminals and check that they are functioning correctly, an AWS Managed Prometheus is used to gather the data of the different users and a AWS Managed Grafana is used to visualize and make alerts.

\section{Deployment}

Finally, for the deployment, in order to automate the deployment in the multiple terminals two tools are used. Github Actions is in charge of building the packages for the different servers and software used which are later defines, and also Ansible is used to automate the instalation of the new software in the different devices.

